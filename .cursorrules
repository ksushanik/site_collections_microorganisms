# Cursor Rules для проекта СИФИБР: Сайт коллекций микроорганизмов

## Проектная специфика

### Научный домен
- **Байкальские микроорганизмы**: Проект фокусируется на уникальных экстремофильных микроорганизмах озера Байкал
- **Экстремофилы**: Особое внимание к психрофилам (холодолюбивые), термофилы, галофилы
- **СИФИБР**: Сибирский институт физиологии и биохимии растений СО РАН
- **17 коллекций**: Объединение разрозненных коллекций в единую систему
- **850,000+ штаммов**: Большой объем данных требует оптимизации с самого начала
- **ExtremeDB**: Совместимость с базой 865 видов экстремофилов

### Существующий прототип для анализа
- **URL**: https://dencr0m8eu.space.minimax.io/
- **Тип**: SPA с анализом 22 коллекций микроорганизмов
- **Ключевые особенности**: Интерактивные таблицы, рейтинговая система, фильтрация
- **Проблемы**: JavaScript ошибки, нужна оптимизация производительности

### Техническая специфика
- **Микросервисная архитектура**: 6 специализированных сервисов
- **Django 4.2+**: Основа backend разработки (API Gateway)
- **React.js 18+**: Frontend с TypeScript
- **Русская локализация**: ru-ru, часовой пояс Asia/Irkutsk
- **PostgreSQL + Redis + Elasticsearch**: Триада хранения данных
- **Биоинформатика**: BLAST, филогенетический анализ, геномные данные

## Микросервисная архитектура

### 6 основных сервисов
```
API Gateway (DRF)      - Единая точка входа, OAuth 2.0, rate limiting
Catalog Service        - Штаммы, коллекции, таксономия
Search Service         - Elasticsearch, фасетный поиск
BLAST Service          - Биоинформатический анализ
Analytics Service      - Статистика, визуализация, экспорт
User Management        - Пользователи, RBAC, аудит
```

### Соглашения именования
- **Сервисы**: catalog-service, search-service, blast-service
- **Модели**: StrainModel, CollectionModel, TaxonomyModel, ExtremeFeatures
- **API endpoints**: /api/v1/strains/, /api/v1/collections/
- **Контейнеры**: sifibr/catalog-service, sifibr/search-service

## Стандарты качества

### Производительность (КРИТИЧНО)
- **API response time**: <200ms для 95% запросов
- **Время загрузки страниц**: <2 секунд
- **Масштабируемость**: 100,000 одновременных пользователей
- **Доступность**: 99.9% uptime

### Безопасность (OWASP Top 10)
- **OAuth 2.0**: Аутентификация для внешних систем
- **Rate limiting**: 100/hour анонимы, 1000/hour пользователи
- **TLS 1.3**: Шифрование всех соединений
- **JWT токены**: Для API доступа

### Доступность (WCAG 2.1 AA)
- **Семантичная разметка**: Proper HTML5 структура
- **Клавиатурная навигация**: Все функции доступны без мыши
- **Цветовой контраст**: Минимум 4.5:1 для текста
- **Альтернативный текст**: Для всех изображений

### FAIR принципы
- **Findable**: Metadata и индексирование
- **Accessible**: Open API и форматы данных
- **Interoperable**: Стандартные форматы (FASTA, GenBank, Darwin Core)
- **Reusable**: Лицензирование и документация

## Форматы данных и стандарты

### Поддерживаемые форматы
```python
SUPPORTED_FORMATS = {
    'FASTA': 'Геномные последовательности',
    'GenBank': 'Аннотированные геномы',
    'Darwin Core': 'Биологические метаданные',
    'JSON-LD': 'Структурированные данные',
    'RDF/OWL': 'Семантическая интеграция',
    'CSV': 'Табличные данные экспорта'
}
```

### Международные стандарты
- **WFCC**: World Federation for Culture Collections
- **MIRRI**: Microbial Resource Research Infrastructure
- **NCBI**: National Center for Biotechnology Information
- **ExtremeDB**: База данных экстремофилов (865 видов)

## Django паттерны (API Gateway)

### API дизайн
- **RESTful + GraphQL**: Гибкость запросов
- **OpenAPI 3.0**: Автоматическая документация
- **Версионирование**: /api/v1/, /api/v2/
- **Пагинация**: PageNumberPagination с 50 записями
- **Throttling**: Встроенная защита от перегрузки

### Микросервисы интеграция
```python
# Межсервисное взаимодействие
MICROSERVICES = {
    'catalog': 'http://catalog-service:8001/api/v1/',
    'search': 'http://search-service:8002/api/v1/',
    'blast': 'http://blast-service:8003/api/v1/',
    'analytics': 'http://analytics-service:8004/api/v1/',
    'users': 'http://user-service:8005/api/v1/',
}
```

### Асинхронная обработка
- **Celery + Redis**: BLAST анализ, экспорт данных
- **WebSockets**: Real-time уведомления
- **Background tasks**: Индексирование для поиска

## UX/UI дизайн-система

### Байкальская тематика
- **Цветовая схема**: Синие тона (#1565C0, #0D47A1, #E3F2FD)
- **Ассоциации**: Вода, глубина, чистота, наука
- **Типографика**: Roboto для интерфейса, JetBrains Mono для кода
- **Иконы**: Material Design + кастомные биологические

### Научный стиль компонентов
- **Таблицы данных**: Сложная сортировка, фильтрация, экспорт
- **Карточки штаммов**: Превью с основной информацией
- **3D визуализация**: Молекулярные структуры
- **Интерактивные графики**: D3.js для филогенетических деревьев
- **Геокарты**: Локации находок с кластеризацией

## Биологическая терминология

### Ключевые термины
- **Штамм (Strain)**: Изолированная культура микроорганизма
- **Коллекция (Collection)**: Группа штаммов объединенных общими характеристиками
- **Таксономия (Taxonomy)**: Классификация организмов (домен, царство, тип, класс, порядок, семейство, род, вид)
- **Экстремофил (Extremophile)**: Организм, процветающий в экстремальных условиях
- **Фенотип (Phenotype)**: Наблюдаемые характеристики (морфология, физиология)
- **Генотип (Genotype)**: Генетическая информация (последовательности ДНК)

### Байкальская специфика
- **Эндемики**: Виды, встречающиеся только в Байкале
- **Психрофилы**: Холодолюбивые организмы (0-15°C)
- **Глубоководные**: Организмы из глубин 200-1600 метров
- **Сезонная динамика**: Изменения популяций по временам года
- **Байкальские экстремофилы**: Уникальные адаптации к озерной среде

## Производительность и оптимизация

### Критические области
- **BLAST анализ**: Асинхронная обработка через Celery
- **Поиск по 850k+ штаммам**: Elasticsearch с proper indexing
- **Географические запросы**: PostGIS оптимизации
- **API Gateway**: Load balancing между микросервисами
- **Bulk операции**: bulk_create/bulk_update для Django ORM

### Мониторинг
- **Prometheus**: Метрики всех микросервисов
- **Grafana**: Dashboards для мониторинга
- **Sentry**: Error tracking и alerting
- **ELK Stack**: Централизованное логирование

## Безопасность данных

### Чувствительные данные
- **Геномные последовательности**: Коммерческая ценность
- **Точные локации**: Не все штаммы для открытого доступа
- **Исследовательские данные**: Уровни доступа по коллекциям
- **Персональные данные**: GDPR compliance для международных пользователей

### Контроль доступа
- **Role-based (RBAC)**: Исследователи, кураторы, администраторы
- **Collection-based**: Доступ к конкретным коллекциям
- **API tokens**: JWT для программного доступа
- **Audit trail**: Полное логирование изменений данных

## Интеграционные паттерны

### Внешние API
- **NCBI**: Таксономические данные, GenBank
- **WFCC**: Стандарты коллекций
- **MIRRI**: Европейские реестры
- **ExtremeDB**: API для экстремофилов

### Асинхронные паттерны
- **Circuit breaker**: Для внешних API
- **Retry с exponential backoff**: Обработка временных сбоев
- **Caching с TTL**: Redis для ответов внешних API
- **Webhook**: Уведомления о изменениях данных

## Тестирование

### Стратегия
- **Unit tests**: pytest для каждого микросервиса
- **Integration tests**: Тестирование межсервисного взаимодействия
- **Performance tests**: Locust для нагрузочного тестирования
- **Security tests**: OWASP ZAP для vulnerability scanning
- **Accessibility tests**: axe-core для WCAG compliance

### Coverage требования
- **Backend**: >80% coverage для всех сервисов
- **Frontend**: >70% coverage для React компонентов
- **API**: 100% coverage для critical endpoints
- **E2E**: Критические пользовательские сценарии

## Memory Bank обновления

### Когда обновлять
- После анализа прототипа https://dencr0m8eu.space.minimax.io/
- При добавлении новых микросервисов
- После интеграции с ExtremeDB
- При изменении требований FAIR/WCAG
- После значимых архитектурных решений

### Приоритетные файлы
- `activeContext.md`: Анализ прототипа и текущие задачи
- `systemPatterns.md`: Микросервисная архитектура
- `progress.md`: Метрики производительности и качества
- `techContext.md`: Новые технологии и интеграции

Этот файл .cursorrules эволюционирует с проектом, отражая уникальные требования СИФИБР и международные стандарты биоинформатики. 